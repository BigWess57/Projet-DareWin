<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:17,&quot;tests&quot;:66,&quot;passes&quot;:66,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2025-10-28T18:04:57.908Z&quot;,&quot;end&quot;:&quot;2025-10-28T18:04:59.303Z&quot;,&quot;duration&quot;:1395,&quot;testsRegistered&quot;:66,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;4ce4ebc3-a8ca-4b83-9f7d-1cd25d657da4&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b0ebc98a-56b1-4a63-90ed-3224020fb05a&quot;,&quot;title&quot;:&quot;tests ChallengeFactory contract&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeFactoryNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeFactoryNEW.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;title&quot;:&quot;First tests&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeFactoryNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeFactoryNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;First tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests \&quot;before each\&quot; hook in \&quot;First tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challengeFactory, signers, token } = await loadFixture(deployedChallengeFactoryFixtureBase));\nawait challengeFactory.createChallenge(duration, maxPlayers, bid, description, 0, ethers.ZeroHash, \&quot;ipfsCid\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;85b66816-ede5-45d9-a9cf-328bab92abef&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should just deploy the challenge factory, and create a challenge&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should just deploy the challenge factory, and create a challenge&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3f8435f7-9bb3-43c1-a2e7-bcafdf843a12&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should should not be possible to deploy with a feeReceiver address to 0&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should should not be possible to deploy with a feeReceiver address to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const ChallengeFactory = await ethers.getContractFactory(&#x27;ChallengeFactory&#x27;);\nawait expect(\n    ChallengeFactory.deploy(token.target, \&quot;0x0000000000000000000000000000000000000000\&quot;)\n).to.be.revertedWith(\&quot;the feeReceiver cannot be address 0!\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1dcac717-4dff-4544-a21c-66a1fdabbbce&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event on new challenge deployment&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should emit an event on new challenge deployment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const filter = challengeFactory.filters.ChallengeCreated(signers[0].address);\n            const events = await challengeFactory.queryFilter(filter, -1)\n            const event = events[0]\n            expect(event.fragment.name).to.equal(&#x27;ChallengeCreated&#x27;)\n            const args = event.args\n            expect(args.admin).to.equal(signers[0].address)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aebeac62-1de4-4d0d-9a1a-2b33f7a9777b&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow to deploy a new challenge contract&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should allow to deploy a new challenge contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// 2. Extract the address from the event\n            const filter = challengeFactory.filters.ChallengeCreated;\n            const events = await challengeFactory.queryFilter(filter, -1)\n            const event = events[0]\n            const newContractAddress = event.args.challengeAddress;\n            // 3. Attach to the deployed challenge\n            const Challenge = await ethers.getContractFactory(\&quot;Challenge\&quot;);\n            const challenge = Challenge.attach(newContractAddress);\n            // Verify initialisation\n            const _duration = await challenge.duration();\n            const _maxPlayers = await challenge.maxPlayers();\n            const _bid = await challenge.bid();\n            const _description = await challenge.description();\n            expect(_duration).to.equal(1000n);\n            expect(_maxPlayers).to.equal(5n);\n            expect(_bid).to.equal(bid);\n            expect(_description).to.equal(\&quot;test\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;950ca066-57e7-4338-a695-129add12aaa8&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow to deploy a new challenge contract in GROUP mode&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should allow to deploy a new challenge contract in GROUP mode&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const playersAllowed = [\n                [signers[0].address],\n                [signers[1].address],\n                [signers[2].address],\n                [signers[3].address],\n                [signers[4].address]\n            ]\n            const merkleTree = StandardMerkleTree.of(playersAllowed, [\&quot;address\&quot;]);\n            await challengeFactory.createChallenge(1111n, maxPlayers, bid+10n, description, true, merkleTree.root, \&quot;ipfsCid\&quot;);\n            // 2. Extract the address from the event\n            const filter = challengeFactory.filters.ChallengeCreated;\n            const events = await challengeFactory.queryFilter(filter, -1)\n            const event = events[1]\n            const newContractAddress = event.args.challengeAddress;\n            // 3. Attach to the deployed challenge\n            const Challenge = await ethers.getContractFactory(\&quot;Challenge\&quot;);\n            const challenge = Challenge.attach(newContractAddress);\n            // Verify initialisation\n            const _duration = await challenge.duration();\n            const _maxPlayers = await challenge.maxPlayers();\n            const _bid = await challenge.bid();\n            const _description = await challenge.description();\n            expect(_duration).to.equal(1111n);\n            expect(_maxPlayers).to.equal(5n);\n            expect(_bid).to.equal(bid+10n);\n            expect(_description).to.equal(\&quot;test\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;82bc75aa-92bc-4ac7-9fe3-24e86b115fe1&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set the caller of the function createChallenge as owner of the challenge&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract First tests should set the caller of the function createChallenge as owner of the challenge&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// 2. Extract the address from the event\n            const filter = challengeFactory.filters.ChallengeCreated;\n            const events = await challengeFactory.queryFilter(filter, -1)\n            const event = events[0]\n            const newContractAddress = event.args.challengeAddress;\n            // 3. Attach to the deployed challenge\n            const Challenge = await ethers.getContractFactory(\&quot;Challenge\&quot;);\n            const challenge = Challenge.attach(newContractAddress);\n            const owner = await challenge.owner()\n            expect(owner).to.equal(signers[0].address)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;820f372d-cdd6-47cd-a359-58b6d0d00afe&quot;,&quot;parentUUID&quot;:&quot;5bf6c066-d7d0-4fcb-ab54-9cb6a3a14d75&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3f8435f7-9bb3-43c1-a2e7-bcafdf843a12&quot;,&quot;1dcac717-4dff-4544-a21c-66a1fdabbbce&quot;,&quot;aebeac62-1de4-4d0d-9a1a-2b33f7a9777b&quot;,&quot;950ca066-57e7-4338-a695-129add12aaa8&quot;,&quot;82bc75aa-92bc-4ac7-9fe3-24e86b115fe1&quot;,&quot;820f372d-cdd6-47cd-a359-58b6d0d00afe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;title&quot;:&quot;ChallengeFactory pagination&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeFactoryNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeFactoryNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;ChallengeFactory pagination\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination \&quot;before each\&quot; hook in \&quot;ChallengeFactory pagination\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challengeFactory, signers, token } = await loadFixture(deployedChallengeFactoryFixtureBase));\n            // Create a bunch of challenges\n            this.numChallenges = 7;\n            this.created = [];\n            const startBlockNumber = (await ethers.provider.getBlock(\&quot;latest\&quot;)).number + 1;\n            for (let i = 0; i &lt; this.numChallenges; i++) {\n                const tx = await challengeFactory.createChallenge(\n                    duration,                // duration\n                    maxPlayers,                   // maxPlayers\n                    bid + BigInt(i),  // bid (just vary slightly)\n                    `desc ${i}`,         // description\n                    false,               // groupMode\n                    ethers.ZeroHash,  // merkleRoot placeholder\n                    \&quot;ipfsCid\&quot; // placeholder for IpfsCid  \n                );\n                const receipt = await tx.wait();\n            }\n            //then, create table once after all creations\n            const filter = challengeFactory.filters.ChallengeCreated();\n            const fromBlock = startBlockNumber; // capture before first create\n            const events = await challengeFactory.queryFilter(filter, fromBlock, \&quot;latest\&quot;);\n            \n            for(let i = 0; i &lt; this.numChallenges; i++) {\n                const challengeAddress = events[i].args.challengeAddress; // or evt.args[1]\n                this.created.push(challengeAddress);\n            }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1f5df7ba-278c-4a3e-b960-cf44e42b1489&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return the first batch when count &lt; total&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination should return the first batch when count &lt; total&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const start = 0;\nconst count = 3;\nconst list = await challengeFactory.getChallenges(start, count);\nexpect(list.length).to.equal(count);\n// first `count` addresses should match\nfor (let i = 0; i &lt; count; i++) {\n    expect(list[i]).to.equal(this.created[i]);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;017317d3-085b-4f68-881a-377eeb3a8b12&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return entire list when count &gt;= total-start&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination should return entire list when count &gt;= total-start&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const start = 2;\nconst count = 10;  // more than remaining\nconst list = await challengeFactory.getChallenges(start, count);\nexpect(list.length).to.equal(this.numChallenges - start);\nfor (let i = start; i &lt; this.numChallenges; i++) {\nexpect(list[i - start]).to.equal(this.created[i]);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;398ae014-d460-4d2c-9165-937f077aaee8&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return empty array when start &gt;= total&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination should return empty array when start &gt;= total&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const start = this.numChallenges;  // equals length\nconst count = 5;\nconst list = await challengeFactory.getChallenges(start, count);\nexpect(list.length).to.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;74eb278c-302e-440d-a875-ff6f0e1eaafe&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return empty if count is zero&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination should return empty if count is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const start = 1;\nconst count = 0;\nconst list = await challengeFactory.getChallenges(start, count);\nexpect(list.length).to.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e2e51a25-34b1-4d2f-9336-d17d49f86cd5&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return last element when start = total - 1 and count &gt;=1&quot;,&quot;fullTitle&quot;:&quot;tests ChallengeFactory contract ChallengeFactory pagination should return last element when start = total - 1 and count &gt;=1&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const start = this.numChallenges - 1;\nconst count = 5;\nconst list = await challengeFactory.getChallenges(start, count);\nexpect(list.length).to.equal(1);\nexpect(list[0]).to.equal(this.created[this.numChallenges - 1]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4fa0a513-f1d0-4375-b1c9-6c6ab73d0914&quot;,&quot;parentUUID&quot;:&quot;bb3842f4-1df3-492e-99dc-a596f72e02f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;017317d3-085b-4f68-881a-377eeb3a8b12&quot;,&quot;398ae014-d460-4d2c-9165-937f077aaee8&quot;,&quot;74eb278c-302e-440d-a875-ff6f0e1eaafe&quot;,&quot;e2e51a25-34b1-4d2f-9336-d17d49f86cd5&quot;,&quot;4fa0a513-f1d0-4375-b1c9-6c6ab73d0914&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;f4d2fe1b-faba-42a5-b709-95537e3194fe&quot;,&quot;title&quot;:&quot;tests Challenge contract&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;title&quot;:&quot;deployment&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;deployment\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract deployment \&quot;before each\&quot; hook in \&quot;deployment\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;signers = await ethers.getSigners();\n//Token deployment\nconst DareWinToken = await ethers.getContractFactory(&#x27;DareWin&#x27;);\ntoken = await DareWinToken.deploy(signers[0].address);\nbid = ethers.parseUnits(\&quot;1000\&quot;, await token.decimals());&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5432ee9-8f28-42b3-92e6-13bac4f98550&quot;,&quot;parentUUID&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should juste deploy the contract&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract deployment should juste deploy the contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Challenge Deployment\nconst Challenge = await ethers.getContractFactory(&#x27;Challenge&#x27;); \nawait expect(\n    Challenge.deploy(signers[0].address, token.target, duration, maxPlayers, bid, description, signers[0].address, false, ethers.ZeroHash, \&quot;ipfsCid\&quot;)\n).to.not.be.reverted&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0480d0c0-505a-4c96-955d-c9f45952a38c&quot;,&quot;parentUUID&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should juste deploy the contract in Group mode&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract deployment should juste deploy the contract in Group mode&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const playersAllowed = [\n    [signers[0].address],\n    [signers[1].address],\n    [signers[2].address],\n    [signers[3].address],\n    [signers[4].address]\n]\nmerkleTree = StandardMerkleTree.of(playersAllowed, [\&quot;address\&quot;]);\nconst Challenge = await ethers.getContractFactory(&#x27;Challenge&#x27;);\n//Challenge Deployment\nawait expect(\n    challenge = await Challenge.deploy(signers[0].address, token.target, duration, maxPlayers, bid, description, signers[0].address, true, merkleTree.root, \&quot;ipfsCid\&quot;)\n).to.not.be.reverted&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ba4a3ff-4db6-4b46-a494-6e617023ff4a&quot;,&quot;parentUUID&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not be possible to deploy with a feeReceiver address to 0&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract deployment should not be possible to deploy with a feeReceiver address to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Challenge Deployment\nconst Challenge = await ethers.getContractFactory(&#x27;Challenge&#x27;); \nawait expect(\n    Challenge.deploy(signers[0].address, token.target, duration, maxPlayers, bid, description, \&quot;0x0000000000000000000000000000000000000000\&quot;, false, ethers.ZeroHash, \&quot;ipfsCid\&quot;)\n).to.be.revertedWith(\&quot;the feeReceiver cannot be address 0!\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ed63288-7bf8-4dd8-b186-2166c6b3e8ba&quot;,&quot;parentUUID&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;GROUP MODE : should not be possible to deploy if the merkle root is 0&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract deployment GROUP MODE : should not be possible to deploy if the merkle root is 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Challenge Deployment\nconst Challenge = await ethers.getContractFactory(&#x27;Challenge&#x27;); \nawait expect(\n    Challenge.deploy(signers[0].address, token.target, duration, maxPlayers, bid, description, signers[0].address, true, ethers.ZeroHash, \&quot;ipfsCid\&quot;)\n).to.be.revertedWith(\&quot;Merkle root required when groupMode is true\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96078cfb-20c9-4a8e-a7d9-440c5e885943&quot;,&quot;parentUUID&quot;:&quot;68481dae-b9d8-4103-8560-f8ed618d219b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0480d0c0-505a-4c96-955d-c9f45952a38c&quot;,&quot;5ba4a3ff-4db6-4b46-a494-6e617023ff4a&quot;,&quot;8ed63288-7bf8-4dd8-b186-2166c6b3e8ba&quot;,&quot;96078cfb-20c9-4a8e-a7d9-440c5e885943&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;title&quot;:&quot;gathering players state&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;gathering players state\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state \&quot;before each\&quot; hook in \&quot;gathering players state\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers, bid, token} = await loadFixture(deployedChallengeFixtureBase));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bdcd2c04-491c-4c88-81c5-2590d0096e9b&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow a player to join, and sends the money to the challenge contract correctly&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should allow a player to join, and sends the money to the challenge contract correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v, r, s, deadline } = await GetRSVsig(signers[0], token, bid, challenge);\nexpect(\n    await token.balanceOf(challenge)\n).to.equal(0)\nawait expect(\n    challenge.joinChallenge(deadline, v, r, s, [])\n)\n.to.not.be.reverted;\n\nexpect(\n    await token.balanceOf(challenge)\n).to.equal(bid)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b68b5ea6-3755-4f2f-bc42-2d6d27ecfb39&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;FOR LINK MODE : should not allow any more participants to join if the max is already reached&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state FOR LINK MODE : should not allow any more participants to join if the max is already reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[1], token, bid, challenge);\nconst { v: v3, r: r3, s: s3, deadline: deadline3 } = await GetRSVsig(signers[2], token, bid, challenge);\nconst { v: v4, r: r4, s: s4, deadline: deadline4 } = await GetRSVsig(signers[3], token, bid, challenge);\nconst { v: v5, r: r5, s: s5, deadline: deadline5 } = await GetRSVsig(signers[4], token, bid, challenge);\nconst { v: v6, r: r6, s: s6, deadline: deadline6 } = await GetRSVsig(signers[5], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.connect(signers[1]).joinChallenge(deadline2, v2, r2, s2, []);\nawait challenge.connect(signers[2]).joinChallenge(deadline3, v3, r3, s3, []);\nawait challenge.connect(signers[3]).joinChallenge(deadline4, v4, r4, s4, []);\nawait challenge.connect(signers[4]).joinChallenge(deadline5, v5, r5, s5, []);\nawait expect(\n    challenge.connect(signers[5]).joinChallenge(deadline6, v6, r6, s6, [])\n).to.be.revertedWith(\&quot;This challenge is already full\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26cec0d9-2934-4767-9406-8b0c97351318&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow a participant to join twice&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should not allow a participant to join twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait expect(challenge.joinChallenge(deadline1, v1, r1, s1, [])).to.be.revertedWith(\&quot;You already joined\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b4251ad3-7214-4aaa-ad59-480d35ec6b7b&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow a player to withdraw from the challenge (before start), while letting the challenge start when required without issues. Money should be sent back to him&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should allow a player to withdraw from the challenge (before start), while letting the challenge start when required without issues. Money should be sent back to him&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//5 players join\nconst { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[1], token, bid, challenge);\nconst { v: v3, r: r3, s: s3, deadline: deadline3 } = await GetRSVsig(signers[2], token, bid, challenge);\nconst { v: v4, r: r4, s: s4, deadline: deadline4 } = await GetRSVsig(signers[3], token, bid, challenge);\nconst { v: v5, r: r5, s: s5, deadline: deadline5 } = await GetRSVsig(signers[4], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.connect(signers[1]).joinChallenge(deadline2, v2, r2, s2, []);\nawait challenge.connect(signers[2]).joinChallenge(deadline3, v3, r3, s3, []);\nawait challenge.connect(signers[3]).joinChallenge(deadline4, v4, r4, s4, []);\nawait challenge.connect(signers[4]).joinChallenge(deadline5, v5, r5, s5, []);\n//one player withdraws from challenge\nexpect(\n    await token.balanceOf(signers[2].address)\n).to.equal(0);\nawait challenge.connect(signers[2]).withdrawFromChallenge();\n//His balance should be 1000\nexpect(\n    await token.balanceOf(signers[2].address)\n).to.equal(bid);\n//Admin successfully starts challenge\nawait challenge.startChallenge();\nexpect(\n   await challenge.currentStatus()\n).to.equal(ChallengeStatus.OngoingChallenge);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ff13c723-f5fb-4c45-a702-2d3ac0ecd033&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow a player to withdraw from the challenge if he hasnt joined&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should not allow a player to withdraw from the challenge if he hasnt joined&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//try to withdraw without having joined, reverts\nawait expect(\n   challenge.withdrawFromChallenge()\n).to.be.revertedWith(\&quot;You have not joined the challenge.\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d83cb60-6e37-46d6-80d4-433750e5759c&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow a player to join, and then withdraw twice&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should not allow a player to join, and then withdraw twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.withdrawFromChallenge();\n//try to withdraw without having joined, reverts\nawait expect(\n   challenge.withdrawFromChallenge()\n).to.be.revertedWith(\&quot;You have not joined the challenge.\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;902bbd6a-1f07-4fe0-81b1-3ce97acc1396&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow a player to join, withdraw and then join again the challenge&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should allow a player to join, withdraw and then join again the challenge&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Needed twice, because of the nonce\nconst { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\n\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.withdrawFromChallenge();\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait expect(\n   challenge.joinChallenge(deadline2, v2, r2, s2, [])\n).to.not.be.reverted&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0fed0ac8-082d-4fcb-9e39-a987b9e7fc4c&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to start the challenge if there is less than 2 players&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should not allow to start the challenge if there is less than 2 players&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait expect(\n    challenge.startChallenge()\n).to.be.revertedWith(\&quot;Not enough players to start the challenge\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;815b5538-0955-4a82-aa4d-85c7c809fbe5&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow the admin to go to the next state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state should allow the admin to go to the next state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[1], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.connect(signers[1]).joinChallenge(deadline2, v2, r2, s2, []);\nawait challenge.startChallenge();\nexpect(\n   await challenge.currentStatus()\n).to.equal(ChallengeStatus.OngoingChallenge);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;38e457bb-6f8e-469b-af67-7469549abb96&quot;,&quot;parentUUID&quot;:&quot;6211499f-a13f-47a5-810b-77ef5bfb968f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b68b5ea6-3755-4f2f-bc42-2d6d27ecfb39&quot;,&quot;26cec0d9-2934-4767-9406-8b0c97351318&quot;,&quot;b4251ad3-7214-4aaa-ad59-480d35ec6b7b&quot;,&quot;ff13c723-f5fb-4c45-a702-2d3ac0ecd033&quot;,&quot;2d83cb60-6e37-46d6-80d4-433750e5759c&quot;,&quot;902bbd6a-1f07-4fe0-81b1-3ce97acc1396&quot;,&quot;0fed0ac8-082d-4fcb-9e39-a987b9e7fc4c&quot;,&quot;815b5538-0955-4a82-aa4d-85c7c809fbe5&quot;,&quot;38e457bb-6f8e-469b-af67-7469549abb96&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:82,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;f9f9c29f-b183-4ec6-bc4e-9ae839f5ccb7&quot;,&quot;title&quot;:&quot;gathering players state (FOR GROUP MODE SPECIFIC TESTS)&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;gathering players state (FOR GROUP MODE SPECIFIC TESTS)\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state (FOR GROUP MODE SPECIFIC TESTS) \&quot;before each\&quot; hook in \&quot;gathering players state (FOR GROUP MODE SPECIFIC TESTS)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Deploying in group mode\n({challenge, signers, bid, token, merkleTree} = await loadFixture(groupModeFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;094039ef-82fa-4b05-8638-19b1f124a8b7&quot;,&quot;parentUUID&quot;:&quot;f9f9c29f-b183-4ec6-bc4e-9ae839f5ccb7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;FOR GROUP MODE : should still allow players to join&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state (FOR GROUP MODE SPECIFIC TESTS) FOR GROUP MODE : should still allow players to join&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[1], token, bid, challenge);\nconst { v: v3, r: r3, s: s3, deadline: deadline3 } = await GetRSVsig(signers[2], token, bid, challenge);\nconst { v: v4, r: r4, s: s4, deadline: deadline4 } = await GetRSVsig(signers[3], token, bid, challenge);\n//Get merkle proof for each player\nconst proof1 = merkleTree.getProof([signers[0].address]);\nconst proof2 = merkleTree.getProof([signers[1].address]);\nconst proof3 = merkleTree.getProof([signers[2].address]);\nconst proof4 = merkleTree.getProof([signers[3].address]);\n//join with proof\nawait expect(\n    challenge.connect(signers[0]).joinChallenge(deadline1, v1, r1, s1, proof1)\n).to.not.be.reverted;\nawait expect(\n    challenge.connect(signers[1]).joinChallenge(deadline2, v2, r2, s2, proof2)\n).to.not.be.reverted;\nawait expect(\n    challenge.connect(signers[2]).joinChallenge(deadline3, v3, r3, s3, proof3)\n).to.not.be.reverted;\nawait expect(\n    challenge.connect(signers[3]).joinChallenge(deadline4, v4, r4, s4, proof4)\n).to.not.be.reverted;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f894f44-c661-4665-be67-d0c5358b9899&quot;,&quot;parentUUID&quot;:&quot;f9f9c29f-b183-4ec6-bc4e-9ae839f5ccb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;FOR GROUP MODE : should not allow a player to join if he is not among those chosen by the admin at creation&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract gathering players state (FOR GROUP MODE SPECIFIC TESTS) FOR GROUP MODE : should not allow a player to join if he is not among those chosen by the admin at creation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[5], token, bid, challenge);\nconst proof1 = merkleTree.getProof([signers[0].address]);\nawait expect(\n    challenge.connect(signers[5]).joinChallenge(deadline1, v1, r1, s1, proof1)\n).to.be.revertedWith(\&quot;You are not allowed to join this challenge.\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1205f2a5-cd98-4146-97f7-de3cdc51209b&quot;,&quot;parentUUID&quot;:&quot;f9f9c29f-b183-4ec6-bc4e-9ae839f5ccb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f894f44-c661-4665-be67-d0c5358b9899&quot;,&quot;1205f2a5-cd98-4146-97f7-de3cdc51209b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;456d4db1-a069-48fb-8327-82e19f808abd&quot;,&quot;title&quot;:&quot;ongoing challenge state&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;ongoing challenge state\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract ongoing challenge state \&quot;before each\&quot; hook in \&quot;ongoing challenge state\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers} = await loadFixture(OngoingChallengeFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e3a13a7-8466-4f40-8629-9e094c3d9207&quot;,&quot;parentUUID&quot;:&quot;456d4db1-a069-48fb-8327-82e19f808abd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;state should be \&quot;OngoingChallenge\&quot; during the challenge. &quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract ongoing challenge state state should be \&quot;OngoingChallenge\&quot; during the challenge. &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(await challenge.currentStatus()).to.equal(ChallengeStatus.OngoingChallenge);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d986444-ef18-4bf4-b41e-664c64125346&quot;,&quot;parentUUID&quot;:&quot;456d4db1-a069-48fb-8327-82e19f808abd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2d986444-ef18-4bf4-b41e-664c64125346&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;title&quot;:&quot;voting for winner state&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;voting for winner state\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state \&quot;before each\&quot; hook in \&quot;voting for winner state\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers} = await loadFixture(VotingForWinnerFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b608b010-7d1d-4a93-b1d7-1f0fed439abe&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should allow a player to vote (for another player).&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should allow a player to vote (for another player).&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.voteForWinner(signers[1].address)\n).to.not.be.reverted;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;31c7d1eb-51ad-4e41-a677-62128e2ec8e7&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow a non player to vote&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should not allow a non player to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n   challenge.connect(signers[5]).voteForWinner(signers[1].address)\n).to.be.revertedWith(\&quot;You are not a player. You cannot vote for winner.\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b1df22d-c858-4f9e-a7e3-271b58df67cc&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow a player to vote twice&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should not allow a player to vote twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await challenge.voteForWinner(signers[1].address);\nawait expect(\n   challenge.voteForWinner(signers[1].address)\n).to.be.revertedWith(\&quot;You have already voted.\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b05ee20-91f2-4787-977d-b0ed9a7f4574&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to go to next state (ChallengeWon) if everyone has not voted (and minimum delay hasn&#x27;t passed)&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should not allow to go to next state (ChallengeWon) if everyone has not voted (and minimum delay hasn&#x27;t passed)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[1].address)\nawait expect(\n   challenge.endWinnerVote()\n).to.be.revertedWith(\&quot;Not all player have voted for a winner yet (and minimum delay has not passed)\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8364951a-5533-4c15-83af-b26c8bc67c48&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow ANYONE to go to next state (ChallengeWon) if everyone has not voted but minimum delay has passed&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should allow ANYONE to go to next state (ChallengeWon) if everyone has not voted but minimum delay has passed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[1].address)\n//Pass enough time\nawait time.increase(votingDelay);\nawait expect(\n   challenge.connect(signers[2]).endWinnerVote()\n).not.to.be.reverted;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cec527ba-4c00-48bc-a836-dacde6b8bc25&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow ANYONE to go to next state (ChallengeWon) when everyone voted&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should allow ANYONE to go to next state (ChallengeWon) when everyone voted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[2]).voteForWinner(signers[2].address) \nawait challenge.connect(signers[3]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[4]).voteForWinner(signers[2].address) \n//Any player can end vote, because everyone has voted\nawait challenge.connect(signers[1]).endWinnerVote();\nexpect(await challenge.currentStatus()).to.equal(ChallengeStatus.ChallengeWon);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9269a3d-34de-405b-8a79-5d38abfd76e9&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow ANYONE to go to next state (ChallengeWon) if no one has voted (even if time has passed)&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract voting for winner state should not allow ANYONE to go to next state (ChallengeWon) if no one has voted (even if time has passed)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Pass enough time\n            await time.increase(votingDelay);\n            //Any player can end vote, because everyone has voted\n            await expect(challenge.connect(signers[1]).endWinnerVote()).to.be.revertedWith(&#x27;Not allowed in this state&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;775ee475-b673-45fb-b068-ddf44846728d&quot;,&quot;parentUUID&quot;:&quot;3bebd658-e710-41ca-9a79-12892e1c032b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;31c7d1eb-51ad-4e41-a677-62128e2ec8e7&quot;,&quot;8b1df22d-c858-4f9e-a7e3-271b58df67cc&quot;,&quot;0b05ee20-91f2-4787-977d-b0ed9a7f4574&quot;,&quot;8364951a-5533-4c15-83af-b26c8bc67c48&quot;,&quot;cec527ba-4c00-48bc-a836-dacde6b8bc25&quot;,&quot;b9269a3d-34de-405b-8a79-5d38abfd76e9&quot;,&quot;775ee475-b673-45fb-b068-ddf44846728d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;title&quot;:&quot;challenge won state&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;challenge won state\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state \&quot;before each\&quot; hook in \&quot;challenge won state\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers, bid, token} = await loadFixture(VotingForWinnerFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc60d155-8b0c-4d07-993f-3450eca05fe0&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;winner should be able to retrieve prize when endWinnerVote() is triggered&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state winner should be able to retrieve prize when endWinnerVote() is triggered&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[2].address) \nawait challenge.connect(signers[2]).voteForWinner(signers[2].address) \nawait challenge.connect(signers[3]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[4]).voteForWinner(signers[2].address) \n//Check balance before\nconst balanceBefore = await token.balanceOf(signers[2].address);\n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[2]).withdrawPrize();\n//Check balance after\nconst balanceAfter = await token.balanceOf(signers[2].address);\nconst diff = balanceAfter - balanceBefore;\nconst expectedDiff = bid*5n - 5n*bid*bronze/100n;\n//Difference should be equal to cash prize won\nexpect(diff).to.equal(expectedDiff); // substract fees too&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2b5d900-9af8-4152-819e-780581cf70a7&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;winner should NOT be able to retrieve prize multiple times&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state winner should NOT be able to retrieve prize multiple times&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[2].address) \nawait challenge.connect(signers[2]).voteForWinner(signers[2].address) \nawait challenge.connect(signers[3]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[4]).voteForWinner(signers[2].address) \n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[2]).withdrawPrize();\nawait expect(\n    challenge.connect(signers[2]).withdrawPrize()\n).to.be.revertedWith(\&quot;You have already withdrawn your prize\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d82d227b-b58d-420c-a3cc-3760841de925&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;When there is a tie, should allow both winners to receive prize&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state When there is a tie, should allow both winners to receive prize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[2].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[1].address)\nawait challenge.connect(signers[2]).voteForWinner(signers[2].address)\nawait challenge.connect(signers[3]).voteForWinner(signers[1].address)\nawait challenge.connect(signers[4]).voteForWinner(signers[4].address)\n//Check balance before for both winners\nconst balanceBefore1 = await token.balanceOf(signers[1].address);\nconst balanceBefore2 = await token.balanceOf(signers[2].address);\n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[1]).withdrawPrize();\n//Check balance after (winner1)\nconst balanceAfter1 = await token.balanceOf(signers[1].address);\nconst diff1 = balanceAfter1 - balanceBefore1;\nconst expectedDiff1 = bid*5n/2n - bid*5n/2n*gold/100n;\nexpect(\n    diff1\n).to.equal(expectedDiff1);\nawait challenge.connect(signers[2]).withdrawPrize();\n//Check balance after (winner2)\nconst balanceAfter2 = await token.balanceOf(signers[2].address);\nconst diff2 = balanceAfter2 - balanceBefore2;\nconst expectedDiff2 = bid*5n/2n - bid*5n/2n*bronze/100n;\nexpect(\n    diff2\n).to.equal(expectedDiff2); //substract fees too&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75238517-9635-40ff-9b92-058b8d1e04b8&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;if more tokens (signers[1] gold tier here), winner should receive more tokens&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state if more tokens (signers[1] gold tier here), winner should receive more tokens&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[1].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[2]).voteForWinner(signers[1].address) \nawait challenge.connect(signers[3]).voteForWinner(signers[0].address) \nawait challenge.connect(signers[4]).voteForWinner(signers[2].address) \n//Check balance before\nconst balanceBefore = await token.balanceOf(signers[1].address);\n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[1]).withdrawPrize();\n//Check balance after\nconst balanceAfter = await token.balanceOf(signers[1].address);\nconst diff = balanceAfter - balanceBefore;\nconst expectedDiff = bid*5n - 5n*bid*gold/100n;\n//Difference should be equal to cash prize won\nexpect(diff).to.equal(expectedDiff); // substract fees too&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54c7a5ff-f3c4-4370-bfcb-183987cb45c2&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;fee receiver should receive half of the fees (the rest is burnt)&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state fee receiver should receive half of the fees (the rest is burnt)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[2].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[2].address)\nawait challenge.connect(signers[2]).voteForWinner(signers[2].address)\nawait challenge.connect(signers[3]).voteForWinner(signers[1].address)\nawait challenge.connect(signers[4]).voteForWinner(signers[4].address)\nconst balanceBefore = await token.balanceOf(signers[0].address);\n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[2]).withdrawPrize();\nconst balanceAfter = await token.balanceOf(signers[0].address);\nconst diff = balanceAfter - balanceBefore;\nconst expectedFeesReceived = 5n*bid/2n*bronze/100n;\n\nexpect(\n    diff\n).to.equal(expectedFeesReceived);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;54643a1c-b594-43f6-b2fa-a00780296134&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;half of the fees should have been burnt&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract challenge won state half of the fees should have been burnt&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;//Players voting\nawait challenge.voteForWinner(signers[0].address)\nawait challenge.connect(signers[1]).voteForWinner(signers[0].address)\nawait challenge.connect(signers[2]).voteForWinner(signers[2].address)\nawait challenge.connect(signers[3]).voteForWinner(signers[1].address)\nawait challenge.connect(signers[4]).voteForWinner(signers[4].address)\nconst initialTotalSupply = await token.totalSupply();\n//End vote\nawait challenge.endWinnerVote();\nawait challenge.connect(signers[0]).withdrawPrize();\nconst finalTotalSupply = await token.totalSupply();\nconst diff = initialTotalSupply - finalTotalSupply;\nconst expectedBurntAmount = bid*5n/2n*platinum/100n;\n\nexpect(\n    diff\n).to.equal(expectedBurntAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a4b1025f-63f0-4cc8-b224-7306b7df8dc6&quot;,&quot;parentUUID&quot;:&quot;155899a5-a95d-48a4-8ef5-b0cad6172043&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2b5d900-9af8-4152-819e-780581cf70a7&quot;,&quot;d82d227b-b58d-420c-a3cc-3760841de925&quot;,&quot;75238517-9635-40ff-9b92-058b8d1e04b8&quot;,&quot;54c7a5ff-f3c4-4370-bfcb-183987cb45c2&quot;,&quot;54643a1c-b594-43f6-b2fa-a00780296134&quot;,&quot;a4b1025f-63f0-4cc8-b224-7306b7df8dc6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:53,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;3b8c59c4-834c-46b5-9775-e8f8c042162d&quot;,&quot;title&quot;:&quot;Owner functions&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not allow not admin player to go to OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Owner functions should not allow not admin player to go to OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers} = await loadFixture(deployedChallengeFixtureBase);\nawait expect(\n   challenge.connect(signers[1]).startChallenge()\n).to.be.revertedWithCustomError(challenge, \&quot;OwnableUnauthorizedAccount\&quot;).withArgs(signers[1].address);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c05c27e-f586-4aa0-9129-7018726f7cbc&quot;,&quot;parentUUID&quot;:&quot;3b8c59c4-834c-46b5-9775-e8f8c042162d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6c05c27e-f586-4aa0-9129-7018726f7cbc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;b02c5331-11a5-429f-a7be-0d84dd9117e6&quot;,&quot;title&quot;:&quot;State functions availability&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;e1420ba6-c219-4a28-b457-e9b2a1f3cf44&quot;,&quot;title&quot;:&quot;state GatheringPlayers&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;state GatheringPlayers\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state GatheringPlayers \&quot;before each\&quot; hook in \&quot;state GatheringPlayers\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers} = await loadFixture(deployedChallengeFixtureBase));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c91670d-750b-4ce3-8e96-714b402310b2&quot;,&quot;parentUUID&quot;:&quot;e1420ba6-c219-4a28-b457-e9b2a1f3cf44&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not allow voteForWinner() in GatheringPlayers state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state GatheringPlayers should not allow voteForWinner() in GatheringPlayers state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.voteForWinner(signers[1].address)\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;09822054-fee6-42b5-a4fc-c153ea99bd98&quot;,&quot;parentUUID&quot;:&quot;e1420ba6-c219-4a28-b457-e9b2a1f3cf44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow endWinnerVote() in GatheringPlayers state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state GatheringPlayers should not allow endWinnerVote() in GatheringPlayers state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.endWinnerVote()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;62068f98-8622-4021-8caa-53731d3972ed&quot;,&quot;parentUUID&quot;:&quot;e1420ba6-c219-4a28-b457-e9b2a1f3cf44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawPrize() in GatheringPlayers state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state GatheringPlayers should not allow withdrawPrize() in GatheringPlayers state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawPrize()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;08209d41-2514-49d8-bf85-5942b8198668&quot;,&quot;parentUUID&quot;:&quot;e1420ba6-c219-4a28-b457-e9b2a1f3cf44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;09822054-fee6-42b5-a4fc-c153ea99bd98&quot;,&quot;62068f98-8622-4021-8caa-53731d3972ed&quot;,&quot;08209d41-2514-49d8-bf85-5942b8198668&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;title&quot;:&quot;state OngoingChallenge&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;state OngoingChallenge\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge \&quot;before each\&quot; hook in \&quot;state OngoingChallenge\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers, bid, token} = await loadFixture(OngoingChallengeFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a0e5a692-fba3-4e75-af0c-0ff73fc64c2f&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not allow joinChallenge() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow joinChallenge() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait expect(\n    challenge.joinChallenge(deadline1, v1, r1, s1, [])\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;efe8f9ab-78e2-4d31-9bb2-126719c42af1&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawFromChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c5627bef-6d6f-4fc4-96c7-2ba9a18c9d28&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow startChallenge() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow startChallenge() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.startChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2592b67c-5cda-40be-9682-ed0b74eb662d&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow voteForWinner() in OngoingChallenge state (if the challenge is not over)&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow voteForWinner() in OngoingChallenge state (if the challenge is not over)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.voteForWinner(signers[1].address)\n).to.be.revertedWith(\&quot;You are not allowed to vote now\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c401f6e-6e2d-459f-a6fe-3e6a0ed4f670&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow voteForWinner() in OngoingChallenge state (if the challenge is over). state should become \&quot;VotingForWinner\&quot; after first player votes at the end of the challenge. &quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should allow voteForWinner() in OngoingChallenge state (if the challenge is over). state should become \&quot;VotingForWinner\&quot; after first player votes at the end of the challenge. &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;expect(await challenge.currentStatus()).to.equal(ChallengeStatus.OngoingChallenge);\n//wait for challenge to end\nawait time.increase(duration);\n\n//should be allowed\nawait expect(\n    challenge.voteForWinner(signers[1].address)\n).to.not.be.reverted;\n//State should have changed\nexpect(await challenge.currentStatus()).to.equal(ChallengeStatus.VotingForWinner);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cbcb1488-2607-4435-8388-3d30d9de53bf&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow endWinnerVote() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow endWinnerVote() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.endWinnerVote()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5d5ec4b-68e6-48ae-96cb-16cea20710ee&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawPrize() in OnGoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state OngoingChallenge should not allow withdrawPrize() in OnGoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawPrize()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c66fd472-5386-4f37-8d82-08e417463f13&quot;,&quot;parentUUID&quot;:&quot;18a6312d-ca57-462f-9b3f-d3d1ae94e18e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;efe8f9ab-78e2-4d31-9bb2-126719c42af1&quot;,&quot;c5627bef-6d6f-4fc4-96c7-2ba9a18c9d28&quot;,&quot;2592b67c-5cda-40be-9682-ed0b74eb662d&quot;,&quot;9c401f6e-6e2d-459f-a6fe-3e6a0ed4f670&quot;,&quot;cbcb1488-2607-4435-8388-3d30d9de53bf&quot;,&quot;f5d5ec4b-68e6-48ae-96cb-16cea20710ee&quot;,&quot;c66fd472-5386-4f37-8d82-08e417463f13&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;title&quot;:&quot;state VotingForWinner&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;state VotingForWinner\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state VotingForWinner \&quot;before each\&quot; hook in \&quot;state VotingForWinner\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers, bid, token} = await loadFixture(VotingForWinnerFixture));&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9f53b2b1-0f6e-49df-a678-1648d101f9fd&quot;,&quot;parentUUID&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not allow joinChallenge() in VotingForWinner state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state VotingForWinner should not allow joinChallenge() in VotingForWinner state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait expect(\n    challenge.joinChallenge(deadline1, v1, r1, s1, [])\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db192dc6-e418-40b7-a41c-6fffb336f92b&quot;,&quot;parentUUID&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state VotingForWinner should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawFromChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25069bb1-8180-42cd-be32-a2c4200fee01&quot;,&quot;parentUUID&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow startChallenge() in VotingForWinner state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state VotingForWinner should not allow startChallenge() in VotingForWinner state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.startChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9f5c2bed-b4f6-42e9-b7d4-079c91aae303&quot;,&quot;parentUUID&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawPrize() in VotingForWinner state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state VotingForWinner should not allow withdrawPrize() in VotingForWinner state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawPrize()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f0f16bf4-78d1-4474-8181-53cf22d8a50b&quot;,&quot;parentUUID&quot;:&quot;8a88ac74-8ace-4858-8b6b-49e7578338d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;db192dc6-e418-40b7-a41c-6fffb336f92b&quot;,&quot;25069bb1-8180-42cd-be32-a2c4200fee01&quot;,&quot;9f5c2bed-b4f6-42e9-b7d4-079c91aae303&quot;,&quot;f0f16bf4-78d1-4474-8181-53cf22d8a50b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;title&quot;:&quot;state ChallengeWon&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;state ChallengeWon\&quot;&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon \&quot;before each\&quot; hook in \&quot;state ChallengeWon\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;({challenge, signers, bid, token} = await loadFixture(EndingVoteFixture));\nawait challenge.endWinnerVote();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;204a0383-6c34-4755-af2f-b04746a270dc&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not allow joinChallenge() in ChallengeWon state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon should not allow joinChallenge() in ChallengeWon state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait expect(\n    challenge.joinChallenge(deadline1, v1, r1, s1, [])\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a42d8800-6fbf-4dfe-b199-957c20cbbc50&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon should not allow withdrawFromChallenge() in OngoingChallenge state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.withdrawFromChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;706efe1b-be25-4998-969e-b4fc4a2b29f2&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow startChallenge() in ChallengeWon state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon should not allow startChallenge() in ChallengeWon state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.startChallenge()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;86de490e-f922-4aa9-96e9-8f821be61305&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow voteForWinner() in ChallengeWon state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon should not allow voteForWinner() in ChallengeWon state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.voteForWinner(signers[1].address)\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7461ada9-ce75-4509-bbea-b6544b14c6b5&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow endWinnerVote() in ChallengeWon state&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract State functions availability state ChallengeWon should not allow endWinnerVote() in ChallengeWon state&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await expect(\n    challenge.endWinnerVote()\n).to.be.revertedWith(\&quot;Not allowed in this state\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7506eebc-b760-4d16-af60-0679ed9130b3&quot;,&quot;parentUUID&quot;:&quot;0c7a796c-72de-4db8-bd79-85ace83c46f3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a42d8800-6fbf-4dfe-b199-957c20cbbc50&quot;,&quot;706efe1b-be25-4998-969e-b4fc4a2b29f2&quot;,&quot;86de490e-f922-4aa9-96e9-8f821be61305&quot;,&quot;7461ada9-ce75-4509-bbea-b6544b14c6b5&quot;,&quot;7506eebc-b760-4d16-af60-0679ed9130b3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000},{&quot;uuid&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;title&quot;:&quot;Events&quot;,&quot;fullFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test/ChallengeNEW.test.js&quot;,&quot;file&quot;:&quot;/test/ChallengeNEW.test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should emit an event when a Player Joined&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when a Player Joined&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers, bid, token} = await loadFixture(deployedChallengeFixtureBase)\nconst { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait expect(challenge.joinChallenge(deadline1, v1, r1, s1, []))\n    .to.emit(challenge, \&quot;PlayerJoined\&quot;)\n    .withArgs(signers[0].address);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;66fa5cd6-67f8-45d9-98be-c4d17ea1e3fe&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event when a Player Withdraws from challenge&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when a Player Withdraws from challenge&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers, bid, token} = await loadFixture(deployedChallengeFixtureBase)\nconst { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait expect(challenge.withdrawFromChallenge())\n    .to.emit(challenge, \&quot;PlayerWithdrawn\&quot;)\n    .withArgs(signers[0].address);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2e06c8f4-ccd7-4904-a55c-73fa5b2e3dad&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event when ChallengeStarted&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when ChallengeStarted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers, bid, token} = await loadFixture(deployedChallengeFixtureBase)\nconst { v: v1, r: r1, s: s1, deadline: deadline1 } = await GetRSVsig(signers[0], token, bid, challenge);\nconst { v: v2, r: r2, s: s2, deadline: deadline2 } = await GetRSVsig(signers[1], token, bid, challenge);\nawait challenge.joinChallenge(deadline1, v1, r1, s1, []);\nawait challenge.connect(signers[1]).joinChallenge(deadline2, v2, r2, s2, []);\nawait expect(challenge.startChallenge())\n    .to.emit(challenge, \&quot;ChallengeStarted\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5870bec0-be19-44ff-a6b5-c83efeccfe4e&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event when ChallengeEnded &quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when ChallengeEnded &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers} = await loadFixture(OngoingChallengeFixture)\n//Pass enough time\nawait time.increase(duration)\nawait expect(challenge.voteForWinner(signers[1].address))\n    .to.emit(challenge, \&quot;ChallengeEnded\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;663864b4-76e9-4bc0-84de-dcffd0b87071&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event when PlayerVoted&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when PlayerVoted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers} = await loadFixture(VotingForWinnerFixture)\nawait expect(challenge.voteForWinner(signers[1].address))\n    .to.emit(challenge, \&quot;PlayerVoted\&quot;)\n    .withArgs(signers[0].address, signers[1].address)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1b3bf75-e879-4ba2-a631-492c73394b22&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit an event when a prize is sent&quot;,&quot;fullTitle&quot;:&quot;tests Challenge contract Events should emit an event when a prize is sent&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {challenge, signers, bid} = await loadFixture(EndingVoteFixture)\nawait challenge.endWinnerVote()\nconst expectedPrize = bid*5n - 5n*bid*BigInt(gold)/100n;\nawait expect(\n    await challenge.connect(signers[1]).withdrawPrize()\n).to.emit(challenge, \&quot;PrizeWithdrawn\&quot;)\n    .withArgs(signers[1].address, expectedPrize)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d64cdf2b-0b7b-4d20-90b7-9aaa539cf149&quot;,&quot;parentUUID&quot;:&quot;e2db7113-c109-4a23-801e-f6207f18c9bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66fa5cd6-67f8-45d9-98be-c4d17ea1e3fe&quot;,&quot;2e06c8f4-ccd7-4904-a55c-73fa5b2e3dad&quot;,&quot;5870bec0-be19-44ff-a6b5-c83efeccfe4e&quot;,&quot;663864b4-76e9-4bc0-84de-dcffd0b87071&quot;,&quot;e1b3bf75-e879-4ba2-a631-492c73394b22&quot;,&quot;d64cdf2b-0b7b-4d20-90b7-9aaa539cf149&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:162,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:40000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:40000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:true,&quot;reportFilename&quot;:&quot;report&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;test-report&quot;,&quot;reportFilename&quot;:&quot;report&quot;,&quot;quiet&quot;:true},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;report&quot;,&quot;reportDir&quot;:&quot;test-report&quot;,&quot;reportTitle&quot;:&quot;backend&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;test-report/assets&quot;,&quot;jsonFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test-report/report.json&quot;,&quot;htmlFile&quot;:&quot;/home/ibuntu/BlockchainDev/Alyra/MyTests/PROJET_FINAL/backend/test-report/report.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>